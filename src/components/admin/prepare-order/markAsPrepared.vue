<template>
  <div>
    <div id="package">
      <div class="card big bg-white border flex flex-row mb-3">
        <div class="d-none d-sm-block">
          <div class="round-head mr-3 big success">
            <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M31.8123 9.81219C31.6352 9.57631 31.3574 9.4375 31.0625 9.4375H25.3078C24.8514 6.2615 22.1128 3.8125 18.8125 3.8125C15.5122 3.8125 12.7736 6.2615 12.3173 9.4375H7.43881L6.21387 0.805812C6.14831 0.343562 5.75262 0 5.28569 0H0.9375C0.41975 0 0 0.41975 0 0.9375C0 1.45525 0.41975 1.875 0.9375 1.875H4.47188C4.47344 1.88594 7.10387 20.4748 7.10437 20.4779C7.26731 21.5531 7.79281 22.5384 8.58744 23.2677C7.96187 23.784 7.5625 24.565 7.5625 25.4375C7.5625 26.7327 8.44281 27.8256 9.63631 28.1509C9.50856 28.4719 9.4375 28.8215 9.4375 29.1875C9.4375 30.7383 10.6992 32 12.25 32C13.8008 32 15.0625 30.7383 15.0625 29.1875C15.0625 28.8589 15.0053 28.5434 14.9012 28.2494H22.7237C22.6197 28.5434 22.5625 28.8588 22.5625 29.1875C22.5625 30.7383 23.8242 32 25.375 32C26.9258 32 28.1875 30.7383 28.1875 29.1875C28.1875 27.6367 26.9258 26.375 25.375 26.375H10.375C9.85806 26.375 9.4375 25.9544 9.4375 25.4375C9.4375 24.9206 9.85806 24.5 10.375 24.5H24.4188C26.509 24.5 28.3594 23.1025 28.9202 21.1006L31.9627 10.6368C32.0451 10.3535 31.9893 10.0481 31.8123 9.81219ZM25.375 28.25C25.8919 28.25 26.3125 28.6706 26.3125 29.1875C26.3125 29.7044 25.8919 30.125 25.375 30.125C24.8581 30.125 24.4375 29.7044 24.4375 29.1875C24.4375 28.6706 24.8581 28.25 25.375 28.25ZM12.25 28.25C12.7669 28.25 13.1875 28.6706 13.1875 29.1875C13.1875 29.7044 12.7669 30.125 12.25 30.125C11.7331 30.125 11.3125 29.7044 11.3125 29.1875C11.3125 28.6706 11.7331 28.25 12.25 28.25ZM18.8125 5.6875C21.3972 5.6875 23.5 7.79031 23.5 10.375C23.5 12.9597 21.3972 15.0625 18.8125 15.0625C16.2278 15.0625 14.125 12.9597 14.125 10.375C14.125 7.79031 16.2278 5.6875 18.8125 5.6875ZM27.1157 20.5917C26.7816 21.7889 25.6726 22.625 24.4188 22.625C23.8849 22.625 12.5233 22.625 11.7437 22.625C10.3443 22.625 9.17375 21.6058 8.95875 20.2012L7.70412 11.3125H12.3173C12.7736 14.4885 15.5122 16.9375 18.8125 16.9375C22.1128 16.9375 24.8514 14.4885 25.3078 11.3125H29.8136C29.8136 11.3125 27.1166 20.5885 27.1157 20.5917ZM17.2121 12.9129C17.5782 13.2789 18.1718 13.279 18.5379 12.9129L21.3504 10.1004C21.7166 9.73425 21.7166 9.14069 21.3504 8.77456C20.9844 8.40844 20.3908 8.40844 20.0246 8.77456L17.875 10.9242L17.6004 10.6496C17.2343 10.2835 16.6407 10.2835 16.2746 10.6496C15.9084 11.0157 15.9084 11.6093 16.2746 11.9754L17.2121 12.9129Z" fill="#059669"/></svg>
          </div>
        </div>
        <div class="d-flex align-items-center w-100">
          <div class="flex-grow-1">
            <div class="d-flex">
              <div class="round-head mr-3 big success d-sm-none">
                <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M31.8123 9.81219C31.6352 9.57631 31.3574 9.4375 31.0625 9.4375H25.3078C24.8514 6.2615 22.1128 3.8125 18.8125 3.8125C15.5122 3.8125 12.7736 6.2615 12.3173 9.4375H7.43881L6.21387 0.805812C6.14831 0.343562 5.75262 0 5.28569 0H0.9375C0.41975 0 0 0.41975 0 0.9375C0 1.45525 0.41975 1.875 0.9375 1.875H4.47188C4.47344 1.88594 7.10387 20.4748 7.10437 20.4779C7.26731 21.5531 7.79281 22.5384 8.58744 23.2677C7.96187 23.784 7.5625 24.565 7.5625 25.4375C7.5625 26.7327 8.44281 27.8256 9.63631 28.1509C9.50856 28.4719 9.4375 28.8215 9.4375 29.1875C9.4375 30.7383 10.6992 32 12.25 32C13.8008 32 15.0625 30.7383 15.0625 29.1875C15.0625 28.8589 15.0053 28.5434 14.9012 28.2494H22.7237C22.6197 28.5434 22.5625 28.8588 22.5625 29.1875C22.5625 30.7383 23.8242 32 25.375 32C26.9258 32 28.1875 30.7383 28.1875 29.1875C28.1875 27.6367 26.9258 26.375 25.375 26.375H10.375C9.85806 26.375 9.4375 25.9544 9.4375 25.4375C9.4375 24.9206 9.85806 24.5 10.375 24.5H24.4188C26.509 24.5 28.3594 23.1025 28.9202 21.1006L31.9627 10.6368C32.0451 10.3535 31.9893 10.0481 31.8123 9.81219ZM25.375 28.25C25.8919 28.25 26.3125 28.6706 26.3125 29.1875C26.3125 29.7044 25.8919 30.125 25.375 30.125C24.8581 30.125 24.4375 29.7044 24.4375 29.1875C24.4375 28.6706 24.8581 28.25 25.375 28.25ZM12.25 28.25C12.7669 28.25 13.1875 28.6706 13.1875 29.1875C13.1875 29.7044 12.7669 30.125 12.25 30.125C11.7331 30.125 11.3125 29.7044 11.3125 29.1875C11.3125 28.6706 11.7331 28.25 12.25 28.25ZM18.8125 5.6875C21.3972 5.6875 23.5 7.79031 23.5 10.375C23.5 12.9597 21.3972 15.0625 18.8125 15.0625C16.2278 15.0625 14.125 12.9597 14.125 10.375C14.125 7.79031 16.2278 5.6875 18.8125 5.6875ZM27.1157 20.5917C26.7816 21.7889 25.6726 22.625 24.4188 22.625C23.8849 22.625 12.5233 22.625 11.7437 22.625C10.3443 22.625 9.17375 21.6058 8.95875 20.2012L7.70412 11.3125H12.3173C12.7736 14.4885 15.5122 16.9375 18.8125 16.9375C22.1128 16.9375 24.8514 14.4885 25.3078 11.3125H29.8136C29.8136 11.3125 27.1166 20.5885 27.1157 20.5917ZM17.2121 12.9129C17.5782 13.2789 18.1718 13.279 18.5379 12.9129L21.3504 10.1004C21.7166 9.73425 21.7166 9.14069 21.3504 8.77456C20.9844 8.40844 20.3908 8.40844 20.0246 8.77456L17.875 10.9242L17.6004 10.6496C17.2343 10.2835 16.6407 10.2835 16.2746 10.6496C15.9084 11.0157 15.9084 11.6093 16.2746 11.9754L17.2121 12.9129Z" fill="#059669"/></svg>
              </div>
              <div>
                <div class="text-tiny font-weight-bold text-muted text-uppercase">
                  Order ID: #{{ order.id }}
                </div>
                <h4 class="mb-4 d-sm-none">
                  {{ !order.fulfilled_date ? 'Mark As Prepared' : 'Order Prepared!' }}
                </h4>
              </div>
            </div>
            <div class="d-flex flex-column flex-md-row justify-content-between">
              <div>
                <h4 class="mb-1 d-none d-sm-block">
                  {{ !order.fulfilled_date ? 'Final Step: Mark Order Prepared' : 'Order Prepared!' }}
                </h4>
                <div class="text-content text-muted lead">
                  Once you click on “Mark As Fulfilled” the customer will receive a notification that the order has been prepared and is ready.
                </div>
              </div>
              <button :disabled="loading || order.fulfilled_date" class="btn btn-primary font-weight-bold mt-3 mt-md-0" @click="prepareStep">
                <svg v-if="order.fulfilled_date" class="mr-2" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M8 16C10.1217 16 12.1566 15.1571 13.6569 13.6569C15.1571 12.1566 16 10.1217 16 8C16 5.87827 15.1571 3.84344 13.6569 2.34315C12.1566 0.842855 10.1217 0 8 0C5.87827 0 3.84344 0.842855 2.34315 2.34315C0.842855 3.84344 0 5.87827 0 8C0 10.1217 0.842855 12.1566 2.34315 13.6569C3.84344 15.1571 5.87827 16 8 16ZM11.707 6.707C11.8892 6.5184 11.99 6.2658 11.9877 6.0036C11.9854 5.7414 11.8802 5.49059 11.6948 5.30518C11.5094 5.11977 11.2586 5.0146 10.9964 5.01233C10.7342 5.01005 10.4816 5.11084 10.293 5.293L7 8.586L5.707 7.293C5.5184 7.11084 5.2658 7.01005 5.0036 7.01233C4.7414 7.0146 4.49059 7.11977 4.30518 7.30518C4.11977 7.49059 4.0146 7.7414 4.01233 8.0036C4.01005 8.2658 4.11084 8.5184 4.293 8.707L6.293 10.707C6.48053 10.8945 6.73484 10.9998 7 10.9998C7.26516 10.9998 7.51947 10.8945 7.707 10.707L11.707 6.707Z" fill="#FCA5A5"/></svg>
                <div class="spinner-border spinner-border-sm mr-2" v-if="loading" />
                Mark as Fulfilled
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>
<script>

import AdminService from '@/api-services/admin.service';

export default {
  name: 'prepareOrderMarkAsPrepared',
  props: ['order'],
  data() {
    return {
      loading: false
    };
  },
  mounted() {
    if(!this.order.fulfilled_date) {
      this.$parent.$parent.nextButtonDisabled = true;
    }
  },
  methods: { 
    async prepareStep() {
      this.loading = true;
      let res = await AdminService.prepareStep({id: this.order.id, step: 'fulfilled'});
      if (res.data.status === "success") {
        this.order.fulfilled_date = res.data.date;
        this.$parent.$parent.nextButtonDisabled = false;
      } else {
        this.$swal(res.data.message, '', 'error');
      }
      this.loading = false;
    }
  }
};
</script>
<style lang="scss" scoped>
  #package {
    .card {
      padding: 16px 24px;
      .btn-primary {
        min-width: 324px;
      }
      &.big {
        padding: 32px;
      }
      .round-head {
        color: #fff;
        background: var(--primary);
        border-radius: 50%;
        width: 40px;
        height: 40px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        text-align: center;
        &.big {
          width: 56px;
          height: 56px;
        }
        &.success {
          background: #ECFDF5;
        }
      }
    }
  }
  @media (max-width: 768px) {
    #package {
      .card {
        .lead {
          font-size: 14px !important;
          font-weight: normal !important;
        }
        .btn-primary {
          min-width: 100%;
        }
      }
    }
  }
</style>