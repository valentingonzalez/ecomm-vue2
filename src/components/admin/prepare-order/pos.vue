<template>
  <div>
    <div id="package">
      <div class="card big bg-white border flex flex-row mb-3">
        <div class="d-none d-sm-block">
          <div class="round-head mr-3 big success">
            <svg width="25" height="32" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M20.122 0H8.992c-.138.038-.278.072-.418.106-.294.071-.59.142-.865.256C5.827 1.17 4.783 2.6 4.608 4.644c-.026.302-.02.604-.013.92.003.148.006.3.006.455h-.913C1.825 6.03.562 7.28.562 9.137c0 6.55 0 13.107-.006 19.657 0 1.718.825 2.75 2.5 3.168.012.004.021.013.03.021l.02.017H17.99c.13-.055.262-.105.395-.155.323-.121.645-.242.924-.432.75-.507 1.17-1.257 1.188-2.163.03-1.26.028-2.516.026-3.774v-.003-.942c.005-2.206.005-4.412-.007-6.618 0-.244.088-.35.288-.482.544-.362 1.044-.387 1.582.006.19.135.407.23.62.323l.161.071c.67.306 1.345-.1 1.376-.837.013-.335.01-.67.008-1.005a53.817 53.817 0 01-.002-.402c0-1.083-.003-2.166-.006-3.25-.006-2.384-.013-4.765.012-7.15.038-2.88-2.07-4.893-4.32-5.143a.162.162 0 01-.07-.025C20.15.012 20.135.005 20.121 0zM3.682 7.9h.888l.007.112c.005.08.01.151.006.226v1.53c0 .8.337 1.144 1.131 1.15.388.005.78.004 1.169.002l.582-.001h7.848c.863 0 1.188-.325 1.188-1.188v-1.85c.147.008.292.011.436.015.333.008.657.016.971.073.45.081.732.519.738 1.037.01.455.008.906.007 1.358V28.82c0 .925-.382 1.312-1.301 1.312H3.657c-.781 0-1.213-.425-1.213-1.218V9.13c0-.812.419-1.225 1.238-1.231zm11.945-6.005l.049.024c-.813 1.056-1.082 2.25-1.057 3.537.018.749.014 1.5.01 2.25-.002.322-.004.643-.004.963v.356H6.502l-.01-.028c-.014-.043-.027-.08-.027-.122.002-.432 0-.864 0-1.296a83.481 83.481 0 01.025-2.854c.05-1.506 1.344-2.8 2.851-2.831 1.47-.031 2.94-.025 4.41-.018.613.003 1.225.005 1.837.005.012 0 .021.005.04.014zm7.053 13.18v.463c-.738-.6-1.42-.575-2.158-.013v-.463c0-.662 0-1.324.002-1.987.001-1.325.002-2.65-.002-3.975-.006-1.531-.894-2.688-2.313-3-.234-.051-.479-.06-.72-.07a12.169 12.169 0 01-.244-.011 6.78 6.78 0 00-.475-.003l-.237.003c-.144-1.475.062-2.782 1.382-3.638 1-.643 2.063-.693 3.114-.137 1.1.581 1.632 1.543 1.644 2.775.014 1.41.011 2.825.009 4.238v.003l-.002 1.69v4.125zm-7.248-2.02H5.71c-.776.007-1.12.344-1.12 1.132v3.687c0 .713.363 1.07 1.082 1.07h9.755c.726 0 1.082-.363 1.082-1.1v-3.72c0-.712-.356-1.068-1.075-1.068zm-8.948 1.907h8.136v2.087H6.484v-2.087zM9.617 26.03a.931.931 0 01.944-.925.935.935 0 01.932.937c-.007.507-.444.938-.944.932a.94.94 0 01-.932-.944zm4.965.95a.952.952 0 00.919-.95.934.934 0 00-.938-.925.942.942 0 00-.938.925c-.006.512.45.962.957.95zm-4.034-4.024a.925.925 0 01-.931-.925c0-.52.438-.957.95-.944a.952.952 0 01.92.95.933.933 0 01-.938.919zm3.084-.933a.94.94 0 00.938.932.926.926 0 00.931-.932.94.94 0 00-.931-.937.953.953 0 00-.938.937zm-8.03-.017a.94.94 0 01.95-.92c.514.013.933.45.92.957a.94.94 0 01-.957.913.918.918 0 01-.913-.95zm1.87 4.03a.94.94 0 00-.944-.924.917.917 0 00-.926.931.945.945 0 00.938.938.949.949 0 00.932-.944z" fill="#059669"/></svg>
          </div>
        </div>
        <div class="d-flex align-items-center w-100">
          <div class="flex-grow-1">
            <div class="d-flex justify-content-between">
              <div class="d-flex">
              <div class="round-head mr-3 big success d-sm-none">
                <svg width="25" height="32" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M20.122 0H8.992c-.138.038-.278.072-.418.106-.294.071-.59.142-.865.256C5.827 1.17 4.783 2.6 4.608 4.644c-.026.302-.02.604-.013.92.003.148.006.3.006.455h-.913C1.825 6.03.562 7.28.562 9.137c0 6.55 0 13.107-.006 19.657 0 1.718.825 2.75 2.5 3.168.012.004.021.013.03.021l.02.017H17.99c.13-.055.262-.105.395-.155.323-.121.645-.242.924-.432.75-.507 1.17-1.257 1.188-2.163.03-1.26.028-2.516.026-3.774v-.003-.942c.005-2.206.005-4.412-.007-6.618 0-.244.088-.35.288-.482.544-.362 1.044-.387 1.582.006.19.135.407.23.62.323l.161.071c.67.306 1.345-.1 1.376-.837.013-.335.01-.67.008-1.005a53.817 53.817 0 01-.002-.402c0-1.083-.003-2.166-.006-3.25-.006-2.384-.013-4.765.012-7.15.038-2.88-2.07-4.893-4.32-5.143a.162.162 0 01-.07-.025C20.15.012 20.135.005 20.121 0zM3.682 7.9h.888l.007.112c.005.08.01.151.006.226v1.53c0 .8.337 1.144 1.131 1.15.388.005.78.004 1.169.002l.582-.001h7.848c.863 0 1.188-.325 1.188-1.188v-1.85c.147.008.292.011.436.015.333.008.657.016.971.073.45.081.732.519.738 1.037.01.455.008.906.007 1.358V28.82c0 .925-.382 1.312-1.301 1.312H3.657c-.781 0-1.213-.425-1.213-1.218V9.13c0-.812.419-1.225 1.238-1.231zm11.945-6.005l.049.024c-.813 1.056-1.082 2.25-1.057 3.537.018.749.014 1.5.01 2.25-.002.322-.004.643-.004.963v.356H6.502l-.01-.028c-.014-.043-.027-.08-.027-.122.002-.432 0-.864 0-1.296a83.481 83.481 0 01.025-2.854c.05-1.506 1.344-2.8 2.851-2.831 1.47-.031 2.94-.025 4.41-.018.613.003 1.225.005 1.837.005.012 0 .021.005.04.014zm7.053 13.18v.463c-.738-.6-1.42-.575-2.158-.013v-.463c0-.662 0-1.324.002-1.987.001-1.325.002-2.65-.002-3.975-.006-1.531-.894-2.688-2.313-3-.234-.051-.479-.06-.72-.07a12.169 12.169 0 01-.244-.011 6.78 6.78 0 00-.475-.003l-.237.003c-.144-1.475.062-2.782 1.382-3.638 1-.643 2.063-.693 3.114-.137 1.1.581 1.632 1.543 1.644 2.775.014 1.41.011 2.825.009 4.238v.003l-.002 1.69v4.125zm-7.248-2.02H5.71c-.776.007-1.12.344-1.12 1.132v3.687c0 .713.363 1.07 1.082 1.07h9.755c.726 0 1.082-.363 1.082-1.1v-3.72c0-.712-.356-1.068-1.075-1.068zm-8.948 1.907h8.136v2.087H6.484v-2.087zM9.617 26.03a.931.931 0 01.944-.925.935.935 0 01.932.937c-.007.507-.444.938-.944.932a.94.94 0 01-.932-.944zm4.965.95a.952.952 0 00.919-.95.934.934 0 00-.938-.925.942.942 0 00-.938.925c-.006.512.45.962.957.95zm-4.034-4.024a.925.925 0 01-.931-.925c0-.52.438-.957.95-.944a.952.952 0 01.92.95.933.933 0 01-.938.919zm3.084-.933a.94.94 0 00.938.932.926.926 0 00.931-.932.94.94 0 00-.931-.937.953.953 0 00-.938.937zm-8.03-.017a.94.94 0 01.95-.92c.514.013.933.45.92.957a.94.94 0 01-.957.913.918.918 0 01-.913-.95zm1.87 4.03a.94.94 0 00-.944-.924.917.917 0 00-.926.931.945.945 0 00.938.938.949.949 0 00.932-.944z" fill="#059669"/></svg>
              </div>
                <div>
                  <div class="text-tiny font-weight-bold text-muted text-uppercase">
                    Order ID: #{{ order.id }}
                  </div>
                  <h4 class="mb-1">Enter in POS</h4>
                </div>
              </div>
              <button :disabled="loading || order.pos_processed_date" class="btn btn-primary btn-sm font-weight-bold d-none d-sm-block" @click="prepareStep">
                <div v-if="order.pos_processed_date">
                  <svg class="mr-2" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M8 16C10.1217 16 12.1566 15.1571 13.6569 13.6569C15.1571 12.1566 16 10.1217 16 8C16 5.87827 15.1571 3.84344 13.6569 2.34315C12.1566 0.842855 10.1217 0 8 0C5.87827 0 3.84344 0.842855 2.34315 2.34315C0.842855 3.84344 0 5.87827 0 8C0 10.1217 0.842855 12.1566 2.34315 13.6569C3.84344 15.1571 5.87827 16 8 16ZM11.707 6.707C11.8892 6.5184 11.99 6.2658 11.9877 6.0036C11.9854 5.7414 11.8802 5.49059 11.6948 5.30518C11.5094 5.11977 11.2586 5.0146 10.9964 5.01233C10.7342 5.01005 10.4816 5.11084 10.293 5.293L7 8.586L5.707 7.293C5.5184 7.11084 5.2658 7.01005 5.0036 7.01233C4.7414 7.0146 4.49059 7.11977 4.30518 7.30518C4.11977 7.49059 4.0146 7.7414 4.01233 8.0036C4.01005 8.2658 4.11084 8.5184 4.293 8.707L6.293 10.707C6.48053 10.8945 6.73484 10.9998 7 10.9998C7.26516 10.9998 7.51947 10.8945 7.707 10.707L11.707 6.707Z" fill="#FCA5A5"/></svg>
                  Order Marked As in POS on {{ formattedProcessedDate }}
                </div>
                <div v-else>
                  <div class="spinner-border spinner-border-sm mr-2" v-if="loading" />
                  Confirm You've Entered The Order Into Your POS System
                </div>
              </button>
            </div>
            <div class="text-content text-muted lead">
              It is a good idea to enter the order into your POS system. The receipt you printed on the last step does have UPC barcodes so that you can easily scan the products back into your POS system.  If the transaction is being paid for online by the customer, you  may want to select a payment tender inside your POS system. Please speak to your system administrator about how your business conducts online transactions.
            </div>
            <button :disabled="loading || order.pos_processed_date" class="btn btn-primary btn-sm font-weight-bold mt-3 py-4 d-sm-none" @click="prepareStep">
              <div v-if="order.pos_processed_date">
                <svg class="mr-2" width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M8 16C10.1217 16 12.1566 15.1571 13.6569 13.6569C15.1571 12.1566 16 10.1217 16 8C16 5.87827 15.1571 3.84344 13.6569 2.34315C12.1566 0.842855 10.1217 0 8 0C5.87827 0 3.84344 0.842855 2.34315 2.34315C0.842855 3.84344 0 5.87827 0 8C0 10.1217 0.842855 12.1566 2.34315 13.6569C3.84344 15.1571 5.87827 16 8 16ZM11.707 6.707C11.8892 6.5184 11.99 6.2658 11.9877 6.0036C11.9854 5.7414 11.8802 5.49059 11.6948 5.30518C11.5094 5.11977 11.2586 5.0146 10.9964 5.01233C10.7342 5.01005 10.4816 5.11084 10.293 5.293L7 8.586L5.707 7.293C5.5184 7.11084 5.2658 7.01005 5.0036 7.01233C4.7414 7.0146 4.49059 7.11977 4.30518 7.30518C4.11977 7.49059 4.0146 7.7414 4.01233 8.0036C4.01005 8.2658 4.11084 8.5184 4.293 8.707L6.293 10.707C6.48053 10.8945 6.73484 10.9998 7 10.9998C7.26516 10.9998 7.51947 10.8945 7.707 10.707L11.707 6.707Z" fill="#FCA5A5"/></svg>
                Order Marked As in POS on {{ formattedProcessedDate }}
              </div>
              <div v-else>
                <div class="spinner-border spinner-border-sm mr-2" v-if="loading" />
                Confirm You've Entered The Order Into Your POS System
              </div>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>
<script>

import AdminService from '@/api-services/admin.service';
import moment from 'moment-timezone';

export default {
  name: 'prepareOrderEnterInPos',
  props: ['order'],
  data() {
    return {
      loading: false
    };
  },
  computed: {
    formattedProcessedDate() {
      return moment.utc(this.order.pos_processed_date).local().format('MMM D, YYYY hh:mm A');
    }
  },
  mounted() {
    if(!this.order.pos_processed_date)
      this.$parent.$parent.nextButtonDisabled = true;
    else
      this.$parent.$parent.nextButtonDisabled = false;
  },
  methods: { 
    async prepareStep() {
      this.loading = true;
      let res = await AdminService.prepareStep({id: this.order.id, step: 'processed'});
      if (res.data.status === "success") {
        this.order.pos_processed_date = res.data.date;
        this.$parent.$parent.nextButtonDisabled = false;
      } else {
        this.$swal(res.data.message, '', 'error');
      }
      this.loading = false;
    }
  }
};
</script>
<style lang="scss" scoped>
  #package {
    .card {
      padding: 16px 24px;
      &.big {
        padding: 32px;
      }
      .round-head {
        color: #fff;
        background: var(--primary);
        border-radius: 50%;
        width: 40px;
        height: 40px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        text-align: center;
        &.big {
          width: 56px;
          height: 56px;
        }
        &.success {
          background: #ECFDF5;
        }
      }
    }
  }
  @media (max-width: 768px) {
    .lead {
      font-size: 14px !important;
      font-weight: normal !important;
    }
  }
</style>